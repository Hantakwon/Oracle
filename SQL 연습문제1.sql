/*
    날짜 : 2025/07/18
    이름 : 한탁원
    내용 : SQL 연습문제 1
*/

-- 실습 1
ALTER SESSION SET "ORACLE SCRIPT" = true;
CREATE USER shop IDENTIFIED BY 1234;
GRANT CONNECT, RESOURCE, UNLIMITED TABLESPACE TO shop;

-- 실습 2
CREATE TABLE CUSTOMER (
    CID VARCHAR2(20) NOT NULL PRIMARY KEY,
    name VARCHAR2(20) NOT NULL,
    hp CHAR(13) DEFAULT NULL,
    address VARCHAR2(200) DEFAULT NULL,
    RDATE DATE NOT NULL
);

CREATE TABLE PRODUCT (
    pno NUMBER(4) NOT NULL PRIMARY KEY,  
    pname VARCHAR2(30) NOT NULL,      
    stock NUMBER DEFAULT 0 NOT NULL,     
    price NUMBER DEFAULT NULL,         
    company VARCHAR2(20) NOT NULL       
);

CREATE TABLE ORDERS (
    ORD_NO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ORD_CID VARCHAR(20) NOT NULL,
    ORD_PNO NUMBER(4) NOT NULL,
    ORD_CNT NUMBER DEFAULT 1 NOT NULL,
    ORD_DATE TIMESTAMP NOT NULL
);

-- 실습 3
INSERT INTO CUSTOMER VALUES('c101', '김유신', '010-1234-1001', '김해시 봉황동', '2022-01-01');
INSERT INTO CUSTOMER VALUES('c102', '김춘추', '010-1234-1002', '경주시 보문동', '2022-01-02');
INSERT INTO CUSTOMER VALUES('c103', '장보고', '010-1234-1003', '완도군 청산면', '2022-01-03');
INSERT INTO CUSTOMER VALUES('c104', '강감찬', '010-1234-1004', '서울시 마포구', '2022-01-04');
INSERT INTO CUSTOMER VALUES('c105', '이성계', NULL, NULL, '2022-01-05');
INSERT INTO CUSTOMER VALUES('c106', '정철', '010-1234-1006', '김해시 봉황동', '2022-01-06');
INSERT INTO CUSTOMER VALUES('c107', '허준', NULL, NULL, '2022-01-07');
INSERT INTO CUSTOMER VALUES('c108', '이순신', '010-1234-1008', '서울시 영등포구', '2022-01-08');
INSERT INTO CUSTOMER VALUES('c109', '송상현', '010-1234-1009', '부산시 동래구', '2022-01-09');
INSERT INTO CUSTOMER VALUES('c110', '정약용', '010-1234-1010', '경기도 광주시', '2022-01-10');

INSERT INTO PRODUCT (PNO, PNAME, STOCK, PRICE, COMPANY) VALUES (1, '새우깡', 5000, 1500, '농심');
INSERT INTO PRODUCT (PNO, PNAME, STOCK, PRICE, COMPANY) VALUES(2, '초코파이', 2500, 2500, '오리온');
INSERT INTO PRODUCT (PNO, PNAME, STOCK, PRICE, COMPANY) VALUES(3, '포카칩', 3600, 1700, '오리온');
INSERT INTO PRODUCT (PNO, PNAME, STOCK, PRICE, COMPANY) VALUES(4, '양파링', 1250, 1800, '농심');
INSERT INTO PRODUCT (PNO, PNAME, STOCK, PRICE, COMPANY) VALUES(5, '꼬깔콘', 2200, NULL, '크라운');
INSERT INTO PRODUCT (PNO, PNAME, STOCK, PRICE, COMPANY) VALUES(6, '마가렛트', 3500, 3500, '롯데');
INSERT INTO PRODUCT (PNO, PNAME, STOCK, PRICE, COMPANY) VALUES(7, '부셔부셔', 1650, 1200, '오뚜기');

INSERT INTO ORDERS (ORD_CID, ORD_PNO, ORD_CNT, ORD_DATE) 
VALUES ('c102', 3, 2, TO_TIMESTAMP('2022-07-01 13:15:10', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO ORDERS (ORD_CID, ORD_PNO, ORD_CNT, ORD_DATE) 
VALUES ('c101', 4, 1, TO_TIMESTAMP('2022-07-01 14:16:11', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO ORDERS (ORD_CID, ORD_PNO, ORD_CNT, ORD_DATE) 
VALUES ('c108', 1, 1, TO_TIMESTAMP('2022-07-01 17:23:18', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO ORDERS (ORD_CID, ORD_PNO, ORD_CNT, ORD_DATE) 
VALUES ('c109', 6, 5, TO_TIMESTAMP('2022-07-02 10:46:36', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO ORDERS (ORD_CID, ORD_PNO, ORD_CNT, ORD_DATE) 
VALUES ('c102', 2, 1, TO_TIMESTAMP('2022-07-03 09:15:37', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO ORDERS (ORD_CID, ORD_PNO, ORD_CNT, ORD_DATE) 
VALUES ('c101', 7, 3, TO_TIMESTAMP('2022-07-03 12:35:12', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO ORDERS (ORD_CID, ORD_PNO, ORD_CNT, ORD_DATE) 
VALUES ('c110', 1, 2, TO_TIMESTAMP('2022-07-03 16:55:36', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO ORDERS (ORD_CID, ORD_PNO, ORD_CNT, ORD_DATE) 
VALUES ('c104', 2, 4, TO_TIMESTAMP('2022-07-04 14:23:23', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO ORDERS (ORD_CID, ORD_PNO, ORD_CNT, ORD_DATE) 
VALUES ('c102', 1, 3, TO_TIMESTAMP('2022-07-05 21:54:34', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO ORDERS (ORD_CID, ORD_PNO, ORD_CNT, ORD_DATE) 
VALUES ('c107', 6, 1, TO_TIMESTAMP('2022-07-05 14:21:03', 'YYYY-MM-DD HH24:MI:SS'));

-- 실습 4
SELECT * FROM CUSTOMER;

-- 실습 5
SELECT CID, NAME, HP FROM CUSTOMER;

-- 실습 6
SELECT * FROM PRODUCT;

-- 실습 7
SELECT COMPANY FROM PRODUCT;

-- 실습 8
SELECT DISTINCT(COMPANY) FROM PRODUCT;

-- 실습 9
SELECT PNAME, PRICE FROM PRODUCT;

-- 실습 10
SELECT PNAME, (PRICE + 500) 조정단가 FROM PRODUCT;

-- 실습 11
SELECT PNAME, STOCK, PRICE FROM PRODUCT WHERE COMPANY = '오리온';

-- 실습 12
SELECT ORD_PNO, ORD_CNT, ORD_DATE FROM ORDERS WHERE ORD_CID = 'c102';

-- 실습 13
SELECT ORD_PNO, ORD_CNT, ORD_DATE FROM ORDERS WHERE ORD_CID = 'c102' AND ORD_CNT >=2;

-- 실습 14
SELECT * FROM PRODUCT WHERE PRICE >= 1000 AND PRICE <= 2000;

-- 실습 15
SELECT CID, NAME, HP, ADDRESS FROM CUSTOMER WHERE NAME LIKE '김%';

-- 실습 16
SELECT CID, NAME, HP, ADDRESS FROM CUSTOMER WHERE NAME LIKE '__';

-- 실습 17
SELECT * FROM CUSTOMER WHERE HP IS NULL;

-- 실습 18
SELECT * FROM CUSTOMER WHERE ADDRESS IS NOT NULL;

-- 실습 19
SELECT * FROM CUSTOMER ORDER BY RDATE DESC;

-- 실습 20
SELECT * FROM ORDERS WHERE ORD_CNT >= 3 ORDER BY ORD_CNT DESC, ORD_PNO ASC;

-- 실습 21
SELECT AVG(PRICE) FROM PRODUCT;

-- 실습 22
SELECT SUM(STOCK) AS "재고량 합계" FROM PRODUCT WHERE COMPANY='농심';

-- 실습 23
SELECT COUNT(*) AS 고객수 FROM CUSTOMER;

-- 실습 24
SELECT COUNT(DISTINCT(COMPANY)) AS "제조 업체 수" FROM PRODUCT;

-- 실습 25
SELECT ORD_PNO AS "주문 상품번호", SUM(ORD_CNT) AS "총 주문수량" FROM ORDERS GROUP BY ORD_PNO ORDER BY ORD_PNO ASC;

-- 실습 26
SELECT COMPANY AS 제조업체, COUNT(*) AS 제품수, MAX(price) AS 최고가 FROM PRODUCT GROUP BY COMPANY

-- 실습 27
SELECT COMPANY AS 제조업체, COUNT(*) AS 제품수, MAX(price) AS 최고가 FROM PRODUCT GROUP BY COMPANY HAVING COUNT(*) >= 2;

-- 실습 28
SELECT ORD_PNO, ORD_CID, SUM(ORD_CNT) AS "총 주문수량" FROM ORDERS GROUP BY ORD_PNO, ORD_CID;

-- 실습 29
SELECT ORD_CID, PNAME FROM ORDERS A
JOIN PRODUCT B ON A.ORD_PNO = B.PNO 
WHERE ORD_CID = 'c102';

-- 실습 30
SELECT ORD_CID, NAME, PNAME, ORD_DATE FROM ORDERS A
JOIN CUSTOMER B ON A.ORD_CID = B.CID
JOIN PRODUCT C ON A.ORD_PNO = C.PNO
WHERE A.ORD_DATE BETWEEN '2022-07-03 00:00:00' AND '2022-07-03 23:59:59';